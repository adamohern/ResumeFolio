<html>

<head>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="css/reset.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
</head>

<body>
    One sec...
</body>

<foot>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="content/content.js"></script>
    <script src="js/showdown.min.js"></script>
    <script src="js/mustache.js"></script>
    <script>
        

        var INDENT = '',
            DEPTH = 1,
            MARKDOWN = new showdown.Converter();

        function renderHTML(json,templates) {
            HTML = '';

            if ((typeof (obj) == 'object') && !(obj instanceof Array)) {

                if (Array.isArray(obj.content)) {
                    content = null;
                } else if (typeof obj.content == "string") {
                    content = obj.content;
                }


                if (Array.isArray(obj.year)) {
                    year1 = obj.year[0];
                    year2 = obj.year[1];
                } else if (obj.year) {
                    year1 = obj.year;
                    year2 = null;
                } else {
                    var year1, year2 = null;
                }

                HTML += Mustache.render(templates.content, {
                    h: "h" + DEPTH,
                    heading: obj.heading,
                    thumb: obj.thumb,
                    subheading: obj.subheading,
                    content: MARKDOWN.makeHtml(content),
                    year1: year1,
                    year2: year2,
                    d: "d" + DEPTH
                });

                if (Array.isArray(obj.content)) {
                    for (i in obj.content) {
                        DEPTH++;
                        INDENT += "\t";

                        HTML += Mustache.render(templates.wrapper, {
                            d: "d" + DEPTH,
                            content: renderHTML(obj.content[i])
                        });

                        DEPTH--;
                        INDENT = INDENT.replace(new RegExp('\\t$'), '');
                    }
                }

                return HTML;

            }
        }

        function randomizeColors() {
            $("a").each(function () {
                $(this).addClass("color_" + Math.floor(Math.random() * 4));
            });
        }
        
        var content = $.get("templates/content.html");
        var wrapper = $.get("templates/wrapper.html");
        $.when(content,wrapper).done(function(content,wrapper) {
            var templates = {
                content: content[0],
                wrapper: wrapper[0]
            };
            $("body").html(renderHTML(CONTENT,templates));
        });
        randomizeColors();
            
    </script>
</foot>

</html>
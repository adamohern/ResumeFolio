<html>

<head>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="reset.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="content.js"></script>
    <script src="showdown.min.js"></script>
    <script src="Please.js"></script>
    <script>
        var CLASSES_YEAR = "year",
            CLASSES_SUBHEADING = "subheading"

        var INDENT = '',
            OUTPUT = '',
            H_DEPTH = '1',
            MARKDOWN = new showdown.Converter();
    </script>
</head>

<body>
    One sec...
</body>

<foot>
    <script>
        function tag(tag, content, classes, id) {
            if (Array.isArray(classes)) classes = " class=\"" + classes.join() + "\"";
            else if (classes) classes = " class=\"" + classes + "\"";
            else classes = "";

            if (id) id = " id=\"" + id + "\"";
            else id = "";

            return "<" + tag + classes + id + ">" + content + "</" + tag + ">";
        }

        function e(string) {
            OUTPUT += string + "\n";
        }

        function pushdent() {
            H_DEPTH++;
            INDENT += "\t";
        }

        function popdent() {
            H_DEPTH--;
            INDENT = INDENT.replace(new RegExp('\\t$'), '');
        }

        function renderHTML(obj) {

            if ((typeof (obj) == 'object') && !(obj instanceof Array)) {

                if (obj.heading) {

                    if (obj.subheading) subheading = " " + tag("span", obj.subheading, CLASSES_SUBHEADING);
                    else subheading = "";

                    e(tag("h" + H_DEPTH, obj.heading + subheading));

                }

                if (Array.isArray(obj.year)) year = tag("span", obj.year[0] + "-" + obj.year[1], "year") + " ";
                else if (obj.year) year = tag("span", obj.year, CLASSES_YEAR) + " ";
                else year = "";

                if (typeof (obj.content) == 'string') {
                    e(MARKDOWN.makeHtml(year + obj.content));
                } else if (Array.isArray(obj.content)) {
                    for (i in obj.content) {
                        pushdent();
                        if (H_DEPTH == 2) e("<section>");
                        e("<div class=\"d" + H_DEPTH + "\">");
                        renderHTML(obj.content[i]);
                        e("</div>");
                        if (H_DEPTH == 2) e("</section>");
                        popdent();
                    }
                }

            }
        }

        function randomizeColors() {
            colors = Please.make_scheme({
                h: 140,
                s: .05,
                v: 1,
                scheme_type: 'analogous', //set scheme type
                format: 'rgb-string', //give it to us in rgb
                colors_returned: $("a").size()
            });
            $("a").each(function (i) {
                $(this).css("background-color", colors[Math.floor(Math.random() * colors.length)]);
            });
        }

        renderHTML(CONTENT);
        document.body.innerHTML = OUTPUT;
        randomizeColors();
    </script>
</foot>

</html>
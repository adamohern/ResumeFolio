<html>
<head>
    <script>

        var WRAPPER =

'<div class="{{ d }}">\
{{{ content }}}\
</div>';

    </script>

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="css/reset.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
</head>

<body>
    One sec...
</body>

<foot>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="content/content.js"></script>
    <script src="js/showdown.min.js"></script>
    <script src="js/mustache.js"></script>
    <script>
        
        var TEMPLATE = (function() {
            var text = null;
            $.ajax({
                'async': false,
                'global': false,
                'url': "templates/content.mst",
                'dataType': "json",
                'success': function (data) {
                    text = data;
                }
            });
            return text;
        })();
        
        var INDENT = '',
            DEPTH = 1,
            MARKDOWN = new showdown.Converter();

        function renderHTML(obj) {
            HTML = '';

            if ((typeof (obj) == 'object') && !(obj instanceof Array)) {

                if (Array.isArray(obj.content)) {
                    content = null;
                } else if (typeof obj.content == "string") {
                    content = obj.content;
                }


                if (Array.isArray(obj.year)) {
                    year1 = obj.year[0];
                    year2 = obj.year[1];
                } else if (obj.year) {
                    year1 = obj.year;
                    year2 = null;
                } else {
                    var year1, year2 = null;
                }

                HTML += Mustache.render(TEMPLATE, {
                    h: "h" + DEPTH,
                    heading: obj.heading,
                    thumb: obj.thumb,
                    subheading: obj.subheading,
                    content: MARKDOWN.makeHtml(content),
                    year1: year1,
                    year2: year2,
                    d: "d" + DEPTH
                });

                if (Array.isArray(obj.content)) {
                    for (i in obj.content) {
                        DEPTH++;
                        INDENT += "\t";

                        HTML += Mustache.render(WRAPPER, {
                            d: "d" + DEPTH,
                            content: renderHTML(obj.content[i])
                        });

                        DEPTH--;
                        INDENT = INDENT.replace(new RegExp('\\t$'), '');
                    }
                }

                return HTML;

            }
        }

        function randomizeColors() {
            $("a").each(function () {
                $(this).addClass("color_" + Math.floor(Math.random() * 4));
            });
        }

        document.body.innerHTML = renderHTML(CONTENT);;
        randomizeColors();
    </script>
</foot>

</html>
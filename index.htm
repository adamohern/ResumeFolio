<html>

<head>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="reset.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="content.js"></script>
    <script src="showdown.min.js"></script>
    <script src="mustache.js"></script>
    <script>
        var TEMPLATE =

'{{ #heading }}\
<{{ h }}>{{{ heading }}}{{ #subheading }} <span class="subheading">{{{ subheading }}}</span>{{ /subheading }}</{{ h }}>\
{{ /heading }}\
{{ #content }}\
<div class="content">\
    {{ #year1 }}<span class="year">{{ year1 }}{{ #year2 }}-{{year2}}{{ /year2 }}</span> {{ /year1 }}<span class="summary">{{{ content }}}</span>\
</div>\
{{ /content }}';
        
        var WRAPPER = 

'<div class="{{ d }}">\
    {{{ content }}}\
</div>';
        
    </script>
</head>

<body>
    One sec...
</body>

<foot>
    <script>
        var INDENT = '',
            OUTPUT = '',
            DEPTH = '1',
            MARKDOWN = new showdown.Converter();

        function e(string) {
            OUTPUT += string + "\n";
        }

        function indent() {
            DEPTH++;
            INDENT += "\t";
        }

        function outdent() {
            DEPTH--;
            INDENT = INDENT.replace(new RegExp('\\t$'), '');
        }

        function h(depth) {
            return "h" + depth;
        }

        function d(depth) {
            return "d" + depth;
        }

        function renderHTML(obj) {
            if ((typeof (obj) == 'object') && !(obj instanceof Array)) {

                if (Array.isArray(obj.content)) { 
                    content = null;
                } else if (typeof obj.content == "string") {
                    content = obj.content;
                }
                
                
                if (Array.isArray(obj.year)) {
                    year1 = obj.year[0];
                    year2 = obj.year[1];
                } else if (obj.year) {
                    year1 = obj.year;
                    year2 = null;
                } else {
                    var year1, year2 = null;
                }
                
                e(Mustache.render(WRAPPER, {
                    
                    d: d(DEPTH),
                    content: Mustache.render(TEMPLATE, {
                        h: h(DEPTH),
                        heading: obj.heading,
                        subheading: obj.subheading,
                        content: MARKDOWN.makeHtml(content),
                        year1: year1,
                        year2: year2,
                        d: d(DEPTH)
                    })
                  
                }));

                if (Array.isArray(obj.content)) {
                    for (i in obj.content) {
                        indent();
                        renderHTML(obj.content[i]);
                        outdent();
                    }
                } 

            }
        }

        function randomizeColors() {
            $("a").each(function () {
                $(this).addClass("color_" + Math.floor(Math.random() * 4));
            });
        }

        renderHTML(CONTENT);
        document.body.innerHTML = OUTPUT;
        randomizeColors();
    </script>
</foot>

</html>